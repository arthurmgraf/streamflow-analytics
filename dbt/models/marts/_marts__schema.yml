version: 2

models:
  - name: dim_customer
    description: "Customer dimension with risk profiling"
    columns:
      - name: customer_id
        description: "Natural key — unique customer identifier"
        tests:
          - unique
          - not_null
      - name: name
        tests:
          - not_null
      - name: risk_profile
        tests:
          - accepted_values:
              values: ["normal", "medium", "high"]

  - name: dim_store
    description: "Store dimension with geolocation"
    columns:
      - name: store_id
        description: "Natural key — unique store identifier"
        tests:
          - unique
          - not_null

  - name: fct_transactions
    description: "Transaction fact table with fraud scoring"
    columns:
      - name: transaction_id
        tests:
          - unique
          - not_null
      - name: customer_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: store_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_store')
              field: store_id
      - name: amount
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: date_key
        tests:
          - not_null

  - name: fct_fraud_alerts
    description: "Fraud alert fact table"
    columns:
      - name: transaction_id
        tests:
          - not_null
      - name: customer_id
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: fraud_score
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1

  - name: agg_hourly_sales
    description: "Hourly sales aggregate per store"
    columns:
      - name: hour_timestamp
        tests:
          - not_null
      - name: store_id
        tests:
          - not_null
      - name: transaction_count
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1

  - name: agg_daily_fraud
    description: "Daily fraud summary aggregate"
    columns:
      - name: date_key
        tests:
          - unique
          - not_null
      - name: total_txns
        tests:
          - not_null
      - name: fraud_rate
        tests:
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 1
