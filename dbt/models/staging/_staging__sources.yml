version: 2

sources:
  - name: bronze
    schema: bronze
    description: "Raw, immutable data from Kafka ingestion via Flink JDBC sink"
    tables:
      - name: raw_transactions
        description: "Raw transaction events from Kafka"
        columns:
          - name: id
            description: "Auto-increment primary key"
          - name: kafka_topic
            tests:
              - not_null
          - name: kafka_partition
            tests:
              - not_null
          - name: kafka_offset
            tests:
              - not_null
          - name: event_timestamp
            tests:
              - not_null
          - name: raw_payload
            description: "JSONB containing transaction fields"
            tests:
              - not_null
          - name: ingested_at
            tests:
              - not_null
          - name: schema_version
            tests:
              - not_null
        freshness:
          warn_after: {count: 30, period: minute}
          error_after: {count: 2, period: hour}
        loaded_at_field: ingested_at

      - name: raw_fraud_alerts
        description: "Fraud detection alerts from Flink fraud detector"
        columns:
          - name: id
            description: "Auto-increment primary key"
          - name: alert_type
            tests:
              - not_null
          - name: transaction_id
            tests:
              - not_null
          - name: customer_id
            tests:
              - not_null
          - name: fraud_score
            tests:
              - not_null
          - name: rules_triggered
            tests:
              - not_null
          - name: detected_at
            tests:
              - not_null
        freshness:
          warn_after: {count: 1, period: hour}
          error_after: {count: 4, period: hour}
        loaded_at_field: detected_at
